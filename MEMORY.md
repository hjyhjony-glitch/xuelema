# MEMORY.md - 长期记忆

## 1. 团队协作原则
### 核心原则
1. 用户只给目标，不参与流程
2. 完全自动化执行，持续迭代直到通过
3. 不是关键问题不询问用户
4. 所有操作经过 ARC 审核验收
5. 团队分工明确

### 团队分工
- RUNBOT（任务协调，不执行代码）
- ARC（高级分析、代码审核）
- DEV（技术实施、代码开发）
- ASS（文档管理、全程记录）

### 历史事件
- 2026-02-19：团队职责明确（DEV/ARC/ASS/RUNBOT分工确定）
- 2026-02-19：团队协作问题处理（DEV误解任务，开发了题库功能而非自动化测试系统）
- 2026-02-19：Git推送问题处理（网络延迟600ms，大文件推送超时）

## 2. 自动化测试流程
### 核心原则
- 用户只给目标，不参与流程
- 完全自动化执行，持续迭代直到通过

### 流程图
```
开发自测 → 完善APP → 本地构建 → 自测功能
              ↓ 不通过
        继续完善 ←──────────
              ↓ 通过
        上传GitHub构建 → CI构建 → 成功 → 完成
```

### 测试顺序（P0优先）
1. 核心功能（任务管理、番茄钟、题库）
2. 数据功能（存储、统计、提醒）
3. 辅助功能（OCR、资源库、社交）

### 自测系统组成
```
├── scripts/build.sh              # 构建脚本
├── scripts/clean_build.sh        # 清理脚本
├── scripts/self_test.sh          # 自测试脚本（Linux/Mac）
├── scripts/self_test.ps1         # 自测试脚本（Windows）
└── tests/
    ├── __init__.py
    └── test_core.py              # 测试框架
```

### 历史事件
- 2026-02-19：自测系统定义（明确≠题库测验）
- 2026-02-19：自测系统组成确定
- 2026-02-20：自动化测试流程建立

## 3. 模型配置规则
- 所有助手使用统一的模型配置
- 模型切换需通过 sessions_spawn 的 model 参数
- DEV/ARC/ASS/RUNBOT 各角色模型保持一致
- 模型变更需记录到 MEMORY.md

### 历史事件
- 2026-02-20：模型配置检查（发现所有助手使用minimax-m2.1）
- 2026-02-20：DeepSeek模型问题处理（发现DeepSeek配置问题）

## 4. 长期记忆修改规则
- MEMORY.md 用于长期记忆（主会话专用）
- daily notes 用于原始日志记录
- 重要决策、事件、教训需同步更新到 MEMORY.md
- 不直接在 shared contexts 中加载 MEMORY.md（安全考虑）
- 每次会话开始时读取 MEMORY.md（main session）

## 5. DeepSeek 模型问题处理规则
### 处理流程
问题发现 → ARC 分析 → 制定方案 → 分配给 DEV → DEV 执行修改 → 验证结果

### 核心原则
- DeepSeek 有问题 → 必须查问题，直至正确后，才开始任务
- 紧急情况也不行

### 历史事件
- 2026-02-20：DeepSeek模型问题发现和处理

## 6. 启动自检清单

### 📋 检查1：团队唤醒状态
- [ ] RUNBOT-ARC 唤醒了？
- [ ] RUNBOT-DEV 唤醒了？
- [ ] RUNBOT-ASS 唤醒了？

### 📋 检查2：记忆文件读取
- [ ] 读取了 memory/YYYY-MM-DD.md（今天的记忆）？
- [ ] 读取了 MEMORY.md（长期记忆）？

**重要性**：
- 了解最近的上下文
- 避免重复工作
- 记住之前的决策

### 📋 检查3：职责边界（最重要！）
- [ ] 这是代码开发工作？我应该分配给 DEV
- [ ] 这是代码审核工作？我应该分配给 ARC
- [ ] 这是文档记录工作？我应该分配给 ASS
- [ ] 我是否准备亲自执行上述工作？

### 📋 检查4：当前任务状态
- [ ] 用户有什么新任务？
- [ ] 任务是否已分配？
- [ ] 团队成员是否在工作？

### 📋 检查5：任务分配流程
**标准流程**：
用户指令 → 我(分析拆解) → sessions_spawn 分配给对应助手 → 跟踪进度 → 验收交付

### 📋 自检规则
- 每次会话开始时执行
- 自检后必须向用户反馈全部5项结果
- 不是关键问题不询问用户

### 历史事件
- 2026-02-19：自检清单上线（5项）
- 2026-02-19：规则制定（自检后必须向用户反馈全部结果）
- 2026-02-20：自检清单优化（格式更新、职责边界强调）

## 7. API Keys 存储
### OpenAI
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxx

### DeepSeek
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxx

### MiniMax
MINIMAX_API_KEY=xxxxxxxxxxxxxxxxxxxxxxxx

### 火山引擎 (DeepSeek)
VOLCANO_API_KEY=e4163865-8666-4e36-9081-efc18cb6b103

## 8. 历史变更记录（时间线）

### 2026-02-20
- **自动化测试流程建立**：明确自测系统≠题库测验
- **团队协作问题**：DEV误解任务，开发了题库功能而非自动化测试系统
- **永久记忆更新**：新增第7-8节（团队协作原则、自动化测试流程）
- **模型配置检查**：发现所有助手使用minimax-m2.1
- **DeepSeek模型问题处理**：发现DeepSeek配置问题
- **自检清单上线**：5项自检清单上线
- **GitHub Actions修复**：添加working-directory: xuelema到workflow
- **学了吗APP构建修复**：本地构建成功，GitHub Actions失败修复
- **记忆系统漏洞修复**：发现并修复6个记忆系统漏洞
- **自检清单优化（格式更新、职责边界强调）**：更新自检清单格式，强调职责边界检查

### 2026-02-19
- **记忆系统漏洞修复**：发现6个漏洞（agents_list配置、模型映射等）
- **启动自检清单上线**：增加5项自检清单
- **团队职责明确**：RUNBOT/ARC/DEV/ASS分工确定
- **会话管理问题**：存在26个历史会话需要清理

## 9. 附录

### 团队沟通规范
- 主会话（main session）使用 MEMORY.md
- 临时讨论使用 daily notes
- 重要决策需同步更新到 MEMORY.md
- 技术细节记录在项目文档中

### 错误处理原则
- 遇到问题先分析，再行动
- 遵循"问题发现 → 分析 → 方案 → 执行 → 验证"流程
- 不确定时主动询问用户
- 记录错误教训避免重复

### 文档更新周期
- 每日：更新 daily notes
- 每周：回顾并同步重要内容到 MEMORY.md
- 每月：审查 MEMORY.md 清理过时信息

### 安全与权限规则
- API Keys 仅本地存储，禁止上传
- MEMORY.md 为主会话专用，不加载到共享上下文
- 敏感信息使用环境变量管理
- 定期轮换 API Keys 确保安全

### 项目最佳实践
- 代码提交前进行自测
- 遵循项目编码规范
- 保持文档与代码同步更新
- 使用版本控制管理变更历史

### 待处理事项
- [ ] 清理历史会话（sessions.json）
- [ ] 验证GitHub Actions构建结果
- [ ] 验证workflow修复是否有效
